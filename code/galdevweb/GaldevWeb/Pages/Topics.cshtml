@page
@model TopicsModel
@{
    ViewData["Active"] = "Topics";
}

<div class="row my-3">
    <div class="col-12">
        <h1>
            @Model.I18n.String(path: "Title", i18n: new StringGeneratorI18n {
            ["de-DE"] = () => "Nach Themen",
            ["en-US"] = () => "By Topic"
            })
        </h1>
    </div>
</div>

@{
    var cards = new List<Node>();

    foreach (var topic in Model.Series.Topics) {
        cards.Add(Node.From(new Dictionary<string, string> {
                    ["Title"] = Model.Series.GetTitleOfTopic(topic),
                    ["Anchor"] = topic,
                    ["Text"] = string.Join("<br/>",
                Model.Series.GetEntriesOfTopic(topic)
                .Select(entry => $"<a href='{Model.Links.GetPathByPage("/Timeline", null, new { name = entry.SeoTitle })}'>{entry.Year} {entry.DisplayName}</a>")
                )
                }));
    }
}

<script src="~/lib/masonry-4.2.2.min.js" async></script>
<script src="~/js/masonryAutoRelayout.js" async></script>
<div class="row" data-masonry='{ "percentPosition": true, "isLayoutInstant": true }'>
    @foreach (var card in cards) {
        <div class="col-sm-6 col-lg-4 my-2">
            <div class="card">
                @if (@card["ImgSrc"].String != "") {
                    @if (@card["Link"].String != "") {
                        <a href="@card["Link"].String"><img class="card-img-top" src="@card["ImgSrc"]" data-toggle="modal" data-target="#iCard@(card.GetHashCode())"></a>
                    } else {
                        <img class="card-img-top" src="@card["ImgSrc"]" data-toggle="modal" data-target="#iCard@(card.GetHashCode())">
                    }
                    <div id="iCard@(card.GetHashCode())" class="modal fade" tabindex="-1" role="dialog">
                        <div class="modal-dialog modal-dialog-centered" style="max-width: 800px;">
                            <div class="modal-content">
                                <div class="modal-body">
                                    <img src="@card["ImgSrc"]" alt="@card["ImgAlt"]" class="img-fluid">
                                </div>
                            </div>
                        </div>
                    </div>
                }
                <div class="card-body">
                    @if (@card["Title"].String != "") {
                        <h5 class="card-title">
                            @if (@card["Anchor"].String != "") {
                                <a name="@card["Anchor"]">@card["Title"]</a>
                            } else {
                                @card["Title"]
                            }
                        </h5>
                    }
                    <p>@Html.Raw(card["Text"])</p>
                </div>
            </div>
        </div>
    }
</div>
